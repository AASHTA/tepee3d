<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- how_to_service.qdoc -->
  <title>Tepee3D 0.2: Service Library How To</title>
  <link rel="stylesheet" type="text/css" href="style/bootstrap.css" />
  <link rel="stylesheet" type="text/css" href="style/font-awesome/css/font-awesome.min.css" />
</head>
<body>
<div class="header"> 
 <div class="container"> 
  <div class="row"> 
   <div class="span2"> 
    <h1> Tepee3D </h1>  
	</div> 
  </div> 
  <div class="row"> 
   <div class="masterhead"> 
    <div class="navbar"> 
     <br /> 
     <div class="navbar-inner"> 
      <div class="container"> 
       <ul class="nav"> 
        <li class="active"><a href="#">Home</a></li> 
        <li><a href="#">The Project</a></li> 
        <li><a href="#">The Team</a></li> 
        <li><a href="#">Downloads</a></li> 
        <li><a href="#">Documentation</a></li> 
       </ul> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
</div> 
<br /> 
<div class="container">
 <div class="row">
  <div class="span12 banner_tp3">
   <h2 class="title">Tepee3D Reference Documentation</h2>  </div> 
 </div> 
 <div class="row">
  <div class="span12 well">
   <ul class="breadcrumb">
    <!--  Breadcrumbs go here -->
<li>Service Library How To</li>
   </ul>
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#getting-the-tepee3d-sources">Getting the Tepee3D sources</a></li>
<li class="level1"><a href="#creating-a-new-project">Creating a new project</a></li>
<li class="level1"><a href="#edition-the-pro-file">Edition the .pro file</a></li>
<li class="level1"><a href="#adding-classes-to-the-project">Adding classes to the project</a></li>
<li class="level1"><a href="#filling-the-class">Filling the class</a></li>
<li class="level2"><a href="#the-header-file">The Header File</a></li>
<li class="level2"><a href="#the-service-user-interface">The Service User Interface</a></li>
<li class="level2"><a href="#service-signals">Service Signals</a></li>
<li class="level2"><a href="#the-source-file">The Source File</a></li>
<li class="level1"><a href="#testing-and-submitting">Testing and submitting</a></li>
</ul>
</div>
<h1 class="title">Service Library How To</h1>
<span class="subtitle"></span>
<!-- $$$how_to_service.html-description -->
<div class="descr"> <a name="details"></a>
<p>The Tepee3DEngine can be further enhanced by the addition of new services libraries. In order to properly implement the requirement of such libraries, this how to will guide you through each step of the process.</p>
<a name="getting-the-tepee3d-sources"></a>
<h2>Getting the Tepee3D sources</h2>
<p>In order to develop a Service Library, you'll need to use some Tepee3D mandatory headers. The Tepee3D sources files are opensource, free to reuse and to modify.</p>
<p>They can be obtained at : <a href="https://gitorious.org/tepee3d">https://gitorious.org/tepee3d</a></p>
<p>In addition you can get inspiration by looking at the ServicesLibraries directory in the sources.</p>
<a name="creating-a-new-project"></a>
<h2>Creating a new project</h2>
<ol class="1">
<li><tt>Using</tt> QtCreator start a new project (Ctrl + N) or File -&gt; New File or Project.</li>
<li><tt>Choose</tt> the template Other Project (in the Projects tab) and Empty Qt Project and press next.</li>
<li><tt>Give</tt> the project a name and choose the path were the project will be saved.</li>
</ol>
<p>As an illustration purpose we created a new project named ExampleService.</p>
<a name="edition-the-pro-file"></a>
<h2>Edition the .pro file</h2>
<p>The .pro files is used to define several variables that will be used to create a Makefile. By default, QtCreator creates and empty .pro file for you that should be named after your project's name (in our case ExampleService.pro)</p>
<p>Select your .pro file and copy paste the content of the template below :</p>
<pre class="cpp">TEMPLATE <span class="operator">=</span> lib

QT       <span class="operator">+</span><span class="operator">=</span> network
QT       <span class="operator">-</span><span class="operator">=</span> gui

CONFIG <span class="operator">+</span><span class="operator">=</span> qt plugin

TARGET <span class="operator">=</span> YOUR_PROJECT_NAMELibrary

DEFINES <span class="operator">+</span><span class="operator">=</span> YOUR_PROJECT_NAME_LIBRARY

SOURCES <span class="operator">+</span><span class="operator">=</span>

HEADERS <span class="operator">+</span><span class="operator">=</span>

DESTDIR      <span class="operator">=</span> PATH_TO_TEPEE3D_SOURCES_DIRECTORY<span class="operator">/</span>libraries<span class="operator">/</span>services_lib

INCLUDEPATH <span class="operator">+</span><span class="operator">=</span> PATH_TO_TEPEE3D_SOURCES_DIRECTORY<span class="operator">/</span>DeveloperAPIFiles<span class="operator">/</span>Services</pre>
<p>Next you should replace every occurence of YOUR_PROJECT_NAME by your project's name and every occurence of PATH_TO_TEPEE3D_SOURCES_DIRECTORY by the absolute path to the Tepee3DSources directory.</p>
<p>In our case that would give us :</p>
<pre class="cpp">TARGET <span class="operator">=</span> ExampleServiceLibrary

DEFINES <span class="operator">+</span><span class="operator">=</span> EXAMPLE_SERVICE_LIBRARY

DESTDIR      <span class="operator">=</span> <span class="operator">/</span>home<span class="operator">/</span>user<span class="operator">/</span>work<span class="operator">/</span>tepee3d<span class="operator">/</span>libraries<span class="operator">/</span>services_lib

INCLUDEPATH <span class="operator">+</span><span class="operator">=</span> <span class="operator">/</span>home<span class="operator">/</span>user<span class="operator">/</span>work<span class="operator">/</span>tepee3d<span class="operator">/</span>DeveloperAPIFiles<span class="operator">/</span>Services</pre>
<a name="adding-classes-to-the-project"></a>
<h2>Adding classes to the project</h2>
<p>Once your .pro is correctly edited, you can proceed by adding your Service Library class in the project.</p>
<ol class="1">
<li><tt>Press</tt> (Ctrl + N) or File -&gt; New File or Project</li>
<li><tt>Select</tt> C++ (in the Files and Classes tab) and C++ Class.</li>
<li><tt>Enter</tt> a class name (and edit if you want to the header and cpp file names).</li>
</ol>
<p>We created a ExempleServiceManager class that as ExempleServiceManager.h as a header file and ExempleServiceManager.cpp as its source file.</p>
<p>QtCreator should have added your class files to the .pro file automatically. It doesn't cost much to check, in your .pro file you should now have :</p>
<pre class="cpp">TEMPLATE <span class="operator">=</span> lib

QT       <span class="operator">+</span><span class="operator">=</span> network
QT       <span class="operator">-</span><span class="operator">=</span> gui

CONFIG <span class="operator">+</span><span class="operator">=</span> qt plugin

TARGET <span class="operator">=</span> ExampleServiceLibrary

DEFINES <span class="operator">+</span><span class="operator">=</span> EXAMPLE_SERVICE_LIBRARY

SOURCES <span class="operator">+</span><span class="operator">=</span> \
            ExampleServiceManager<span class="operator">.</span>cpp

HEADERS <span class="operator">+</span><span class="operator">=</span> \
            ExampleServiceManager<span class="operator">.</span>h

DESTDIR      <span class="operator">=</span> <span class="operator">/</span>home<span class="operator">/</span>user<span class="operator">/</span>work<span class="operator">/</span>tepee3d<span class="operator">/</span>libraries<span class="operator">/</span>services_lib

INCLUDEPATH <span class="operator">+</span><span class="operator">=</span> <span class="operator">/</span>home<span class="operator">/</span>user<span class="operator">/</span>work<span class="operator">/</span>tepee3d<span class="operator">/</span>DeveloperAPIFiles<span class="operator">/</span>Services</pre>
<p>If SOURCES and HEADERS are still empty, that means that QtCreator did not add your class files and you should fill them accordingly to the code sample above but using your class files' names instead.</p>
<a name="filling-the-class"></a>
<h2>Filling the class</h2>
<p>Now that the project is correctly configured we can focus on filling our class.</p>
<a name="the-header-file"></a>
<h3>The Header File</h3>
<p>We will first fill the header file and then pursue with the source file.</p>
<p>All Services Libraries have to implement the ServiceInterface of the Services namespace.</p>
<pre class="cpp"><span class="keyword">namespace</span> Services
{

<span class="keyword">class</span> ServiceInterface
{

<span class="keyword">public</span> :
    <span class="keyword">virtual</span> <span class="type">void</span>        initLibraryConnection(<span class="type">QObject</span> <span class="operator">*</span>parent) <span class="operator">=</span> <span class="number">0</span>;
    <span class="keyword">virtual</span> <span class="type">bool</span>        connectServiceToUser(<span class="type">QObject</span> <span class="operator">*</span>user) <span class="operator">=</span> <span class="number">0</span>;
    <span class="keyword">virtual</span> <span class="type">bool</span>        disconnectServiceFromUser(<span class="type">QObject</span> <span class="operator">*</span>user) <span class="operator">=</span> <span class="number">0</span>;
    <span class="keyword">virtual</span> <span class="type">QObject</span><span class="operator">*</span>    getLibraryQObject() <span class="operator">=</span> <span class="number">0</span>;
};

}</pre>
<p>That means the header file for our ExampleServiceManager class should look like the sample below :</p>
<pre class="cpp"><span class="preprocessor">#ifndef EXEMPLESERVICEMANAGER_H</span>
<span class="preprocessor">#define EXEMPLESERVICEMANAGER_H</span>

<span class="preprocessor">#include &lt;QObject&gt;</span>
<span class="preprocessor">#include &lt;ServiceManager.h&gt;</span>

<span class="keyword">class</span> ExempleServiceManager : <span class="keyword">public</span> <span class="type">QObject</span><span class="operator">,</span> Services<span class="operator">::</span>ServiceInterface
{
    Q_OBJECT
    Q_INTERFACES(Services<span class="operator">::</span>ServiceInterface)
    Q_PLUGIN_METADATA(IDD <span class="string">&quot;com.tepee3d.Services.exampleservice&quot;</span>)
<span class="keyword">public</span>:
    ExempleServiceManager();

    <span class="type">void</span>        initLibraryConnection(<span class="type">QObject</span> <span class="operator">*</span>parent);
    <span class="type">bool</span>        connectServiceToUser(<span class="type">QObject</span> <span class="operator">*</span>user);
    <span class="type">bool</span>        disconnectServiceFromUser(<span class="type">QObject</span> <span class="operator">*</span>user);
    <span class="type">QObject</span><span class="operator">*</span>    getLibraryQObject();
};

<span class="preprocessor">#endif // EXEMPLESERVICEMANAGER_H</span></pre>
<a name="the-service-user-interface"></a>
<h3>The Service User Interface</h3>
<p>In order to ensure that the objects that will be registering to our service have the necessary methods, you should create an interface file for your Service.</p>
<p>This file should directly be inserted in the Tepee3D Services include directory which is located at DevelopmentFiles/Services/.</p>
<p>A simple Service Interface could look like the following:</p>
<pre class="cpp"><span class="preprocessor">#ifndef EXAMPLESERVICEUSERINTERFACE_H</span>
<span class="preprocessor">#define EXAMPLESERVICEUSERINTERFACE_H</span>

<span class="keyword">namespace</span> Services
{
<span class="keyword">class</span>   ExampleServiceUserInterface
{
<span class="keyword">public</span> :

};
}

<span class="preprocessor">#endif // EXAMPLESERVICEUSERINTERFACE_H</span></pre>
<p>If the use of your service requires method to be implemented, you should declare pure virtual method in the interface. For example the WebServiceUserInterface contains a method for receiving network request that users of the service must implement.</p>
<pre class="cpp"><span class="keyword">virtual</span> <span class="type">void</span> receiveResultFromHttpRequest(<span class="type">QNetworkReply</span> <span class="operator">*</span>) <span class="operator">=</span> <span class="number">0</span>;</pre>
<a name="service-signals"></a>
<h3>Service Signals</h3>
<p>Moreover, you should document the SIGNALS used to make a request to your Service. Comment in the interface are sufficient thought a declaration in the interface would be better but impossible as an Interface cannot inherit from QObject. Therefore comments are the only available option.</p>
<a name="the-source-file"></a>
<h3>The Source File</h3>
<p>Once our header file and our interface have been properly created we can fill the class source file. A minimum source file should look like the one below :</p>
<pre class="cpp"><span class="preprocessor">#include &quot;ExempleServiceManager.h&quot;</span>

ExempleServiceManager<span class="operator">::</span>ExempleServiceManager()
{
}

<span class="type">void</span> ExempleServiceManager<span class="operator">::</span>initLibraryConnection(<span class="type">QObject</span> <span class="operator">*</span>parent)
{
    <span class="comment">// DO YOUR SERVICE INITIALIZATION HERE IF NEEDED</span>
}

<span class="type">bool</span> ExempleServiceManager<span class="operator">::</span>connectServiceToUser(<span class="type">QObject</span> <span class="operator">*</span>user)
{
   <span class="comment">// CALLED TO REGISTER A USER TO THE SERVICE</span>
   <span class="keyword">if</span> (<span class="keyword">dynamic_cast</span><span class="operator">&lt;</span>Services<span class="operator">::</span>ExampleServiceUserInterface<span class="operator">*</span><span class="operator">&gt;</span>(user) <span class="operator">!</span><span class="operator">=</span> NULL)
   {
       <span class="comment">// DO SIGNAL CONNECTIONS HERE</span>
       <span class="operator">.</span><span class="operator">.</span><span class="operator">.</span>
   }
}

<span class="type">bool</span> ExempleServiceManager<span class="operator">::</span>disconnectServiceFromUser(<span class="type">QObject</span> <span class="operator">*</span>user)
{
   <span class="comment">// CALLED TO UNREGISTER A USER FROM THE SERVICE</span>
   <span class="keyword">if</span> (<span class="keyword">dynamic_cast</span><span class="operator">&lt;</span>Services<span class="operator">::</span>ExampleServiceUserInterface<span class="operator">*</span><span class="operator">&gt;</span>(user) <span class="operator">!</span><span class="operator">=</span> NULL)
   {
       <span class="comment">// DO SIGNAL DISCONNECTION HERE</span>
       <span class="operator">.</span><span class="operator">.</span><span class="operator">.</span>
   }
}

<span class="type">QObject</span> <span class="operator">*</span>ExempleServiceManager<span class="operator">::</span>getLibraryQObject()
{
   <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre>
<a name="testing-and-submitting"></a>
<h2>Testing and submitting</h2>
<p>Now you just have to test it and you can submit it on gitorious if you'd like to contribute to Tepee3D.</p>
<p>In any case if the you need help, are struggling on a small point or anyother problem, please contact us as tepee3d_2014@labeip.epitech.eu</p>
</div>
<!-- @@@how_to_service.html -->
  </div>
 </div> 
</div> 
<footer class="footer">
 <div class="container">
  <div class="row">
   <div class="row">
    <div class="span2 offset1">
     <ul> 
      <li class="title">Tepee3D</li> 
      <li><a>Downloads</a></li> 
      <li><a>Developers</a></li> 
      <li><a>Contribute</a></li> 
      <li><a>Gitorious</a></li> 
     </ul> 
    </div> 
    <div class="span2">
     <ul> 
      <li class="title">Qt</li> 
      <li><a>Qt-Project</a></li> 
     </ul> 
    </div> 
    <div class="span2">
     <ul> 
      <li class="title">Contact</li> 
      <li><a><i class="icon-facebook"></i>&nbsp Facebook</a></li> 
      <li><a><i class="icon-twitter"></i>&nbsp Twitter</a></li> 
      <li><a><i class="icon-google-plus"></i>&nbsp Google+</a></li> 
      <li><a><i class="icon-envelope"></i>&nbsp @Mail</a></li> 
     </ul> 
    </div> 
   </div> 
  </div> 
 </div> 
</footer> 
</body>
</html>
