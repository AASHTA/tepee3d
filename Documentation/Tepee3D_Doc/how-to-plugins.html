<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- how-to-plugins.qdoc -->
  <title>Tepee3D 0.2: Plugins How To</title>
  <link rel="stylesheet" type="text/css" href="style/bootstrap.css" />
  <link rel="stylesheet" type="text/css" href="style/font-awesome/css/font-awesome.min.css" />
</head>
<body>
<div class="header"> 
 <div class="container"> 
  <div class="row"> 
   <div class="span2"> 
    <h1> Tepee3D </h1>  
	</div> 
  </div> 
  <div class="row"> 
   <div class="masterhead"> 
    <div class="navbar"> 
     <br /> 
     <div class="navbar-inner"> 
      <div class="container"> 
       <ul class="nav"> 
        <li class="active"><a href="#">Home</a></li> 
        <li><a href="#">The Project</a></li> 
        <li><a href="#">The Team</a></li> 
        <li><a href="#">Downloads</a></li> 
        <li><a href="#">Documentation</a></li> 
       </ul> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
</div> 
<br /> 
<div class="container">
 <div class="row">
  <div class="span12 banner_tp3">
   <h2 class="title">Tepee3D Reference Documentation</h2>  </div> 
 </div> 
 <div class="row">
  <div class="span12 well">
   <ul class="breadcrumb">
    <!--  Breadcrumbs go here -->
<li>Plugins How To</li>
   </ul>
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#getting-the-tepee3d-plugins-api-files">Getting the Tepee3D Plugins API files</a></li>
<li class="level1"><a href="#creating-a-new-plugin-with-qtcreator">Creating a new plugin with Qtcreator</a></li>
<li class="level1"><a href="#edition-the-pro-file">Edition the .pro file</a></li>
<li class="level1"><a href="#add-your-class">Add your class</a></li>
<li class="level1"><a href="#add-your-qml">Add your qml</a></li>
<li class="level1"><a href="#tips">Tips</a></li>
<li class="level2"><a href="#interacting-with-c-class-and-qml">Interacting with c++ class and qml</a></li>
<li class="level2"><a href="#interaction-with-the-database">Interaction with the database</a></li>
<li class="level1"><a href="#results">Results</a></li>
<li class="level1"><a href="#plugins-exemple">Plugins exemple</a></li>
</ul>
</div>
<h1 class="title">Plugins How To</h1>
<span class="subtitle"></span>
<!-- $$$how_to_plugins.html-description -->
<div class="descr"> <a name="details"></a>
<p>The application's rooms will contain widgets. They are tri-dimensional models which provide information or services for the user. The purpose of this page is to explain how to easily develop a widget.</p>
<a name="getting-the-tepee3d-plugins-api-files"></a>
<h2>Getting the Tepee3D Plugins API files</h2>
<p>If you want to create your widget, the first thing to do is to get the Development API files. you can dowload them at this address : <a href="https://gitorious.org/tepee3d/tepee3d/archive-tarball/master">https://gitorious.org/tepee3d/tepee3d/archive-tarball/master</a></p>
<a name="creating-a-new-plugin-with-qtcreator"></a>
<h2>Creating a new plugin with Qtcreator</h2>
<ol class="1">
<li><tt>Using</tt> QtCreator start a new project (Ctrl + N) or File -&gt; New File or Project.</li>
<li><tt>Choose</tt> the template Other Project (in the Projects tab) and Empty Qt Project and press next.</li>
<li><tt>Give</tt> the project a name and choose the path were the project will be saved.</li>
</ol>
<a name="edition-the-pro-file"></a>
<h2>Edition the .pro file</h2>
<p>Select your .pro file and copy the content of the template below</p>
<pre class="cpp"> TEMPLATE        <span class="operator">=</span> lib
 CONFIG         <span class="operator">+</span><span class="operator">=</span> qt plugin
 QT             <span class="operator">+</span><span class="operator">=</span> quick
 QT             <span class="operator">+</span><span class="operator">=</span> gui

<span class="preprocessor">#include development files</span>
   <span class="keyword">include</span> (<span class="operator">.</span><span class="operator">.</span><span class="operator">/</span>DeveloperAPIFiles<span class="operator">/</span>DevelopmentFiles<span class="operator">.</span>pri)

TARGET          <span class="operator">=</span> NAME_OF_THE_PLUGIN_LIBRARY
DESTDIR         <span class="operator">=</span> WHERE_TO_PUT_THE LIBRARY
DESTDIRQML      <span class="operator">=</span> qml_folder</pre>
<a name="add-your-class"></a>
<h2>Add your class</h2>
<p>Now, your are ready to start developing your own widget. You should create your main class that inherits from Pluginsbase.</p>
<p>In your header file :</p>
<pre class="cpp"><span class="keyword">class</span> ClassName : <span class="keyword">public</span> Plugins<span class="operator">::</span>PluginBase          <span class="comment">// MANDATORY FOR PLUGIN DEVELOPMENT</span>
{
    Q_OBJECT                        <span class="comment">// NECESSARY FOR QOBJECT INHERITANCE</span>
    Q_PLUGIN_METADATA(IID <span class="string">&quot;com.tepee3d.plugins.testplugin&quot;</span>) <span class="comment">// REPLACE testplugin BY YOUR PLUGIN NAME</span>

<span class="operator">.</span><span class="operator">.</span><span class="operator">.</span></pre>
<p>In your cpp file :</p>
<pre class="cpp"> ClassName<span class="operator">::</span> ClassName() : PluginBase()
<span class="operator">.</span><span class="operator">.</span><span class="operator">.</span></pre>
<p>This class should implemente this list of methods :</p>
<pre class="cpp">   <span class="type">int</span>                          getPluginId();
    <span class="type">void</span>                        initPlugin();
    Q_INVOKABLE <span class="type">QString</span>         getPluginName();
    <span class="type">QString</span>                     getPluginDescription();
    PluginBase<span class="operator">*</span>                 getPluginBase();
    PluginBase<span class="operator">*</span>                 createNewInstance();
    <span class="type">QString</span>                     getRoomPluginQmlFile() <span class="keyword">const</span>;
    <span class="type">QString</span>                     getMenuPluginQmlFile() <span class="keyword">const</span>;
    <span class="comment">// DatabaseServiceUserInterface</span>
    <span class="type">void</span>                        receiveResultFromSQLQuery(<span class="type">QList</span><span class="operator">&lt;</span><span class="type">QSqlRecord</span><span class="operator">&gt;</span> result<span class="operator">,</span> <span class="type">int</span> id);
    <span class="comment">// WebServiceUserInterface</span>
    <span class="type">void</span>                        receiveResultFromHttpRequest(<span class="type">QNetworkReply</span> <span class="operator">*</span> reply);
    <span class="type">void</span>                        exposeContentToQml(<span class="type">QQmlContext</span> <span class="operator">*</span>context);</pre>
<a name="add-your-qml"></a>
<h2>Add your qml</h2>
<p>When your create your qml file, you can link your main qml file with function getRoomPluginQmlFile(). In this example, Widget.qml is your qml file.</p>
<pre class="cpp"><span class="type">QString</span> YourClass<span class="operator">::</span>getRoomPluginQmlFile() <span class="keyword">const</span>
{
    <span class="keyword">return</span> <span class="type">QString</span>(<span class="string">&quot;Widget.qml&quot;</span>);
}</pre>
<a name="tips"></a>
<h2>Tips</h2>
<a name="interacting-with-c-class-and-qml"></a>
<h3>Interacting with c++ class and qml</h3>
<p>In your main class, implement the function exposeContentToQml in this way :</p>
<pre class="cpp"><span class="type">void</span>   Yourclass<span class="operator">::</span>exposeContentToQml(<span class="type">QQmlContext</span> <span class="operator">*</span>context)
{
    <span class="keyword">this</span><span class="operator">-</span><span class="operator">&gt;</span>context <span class="operator">=</span> context;
    <span class="keyword">this</span><span class="operator">-</span><span class="operator">&gt;</span>context<span class="operator">-</span><span class="operator">&gt;</span>setContextProperty(<span class="string">&quot;apc&quot;</span><span class="operator">,</span><span class="keyword">this</span>);
}</pre>
<p>Now you have an element &quot;apc&quot; in your qml file and you can call every invokable function from your cpp class in your qml. In order to call a qml function from your cpp class, you should process as described below :</p>
<pre class="cpp"><span class="type">QQmlComponent</span> component(<span class="keyword">this</span><span class="operator">-</span><span class="operator">&gt;</span>context<span class="operator">-</span><span class="operator">&gt;</span>engine()<span class="operator">,</span> PATH_TO_YOUR_WIDGETFILE);
        <span class="type">QObject</span> <span class="operator">*</span>object <span class="operator">=</span> component<span class="operator">.</span>create();
        <span class="type">QVariant</span> returnedValue;
        <span class="type">QVariant</span> msg <span class="operator">=</span> <span class="string">&quot;example&quot;</span>
        <span class="type">QMetaObject</span><span class="operator">::</span>invokeMethod(object<span class="operator">,</span> QML_FUNCTION_NAME<span class="operator">,</span>
                Q_RETURN_ARG(<span class="type">QVariant</span><span class="operator">,</span> returnedValue)<span class="operator">,</span>
                Q_ARG(<span class="type">QVariant</span><span class="operator">,</span> msg));
        <span class="keyword">delete</span> object;</pre>
<a name="interaction-with-the-database"></a>
<h3>Interaction with the database</h3>
<p>If you want execute a query in the database of the application, you just have to use the signal executeSQLQuery in this way :</p>
<pre class="cpp"> <span class="keyword">emit</span> (PluginBase<span class="operator">::</span>executeSQLQuery(YOURQUERY<span class="operator">,</span><span class="keyword">this</span><span class="operator">,</span>ID_QUERY));</pre>
<p>You will receive the answer of your query in the function receiveResultFromSQLQuery</p>
<a name="results"></a>
<h2>Results</h2>
<p>When you have compiled your project, if you are under linux you will have a file .so or .dll under windows. Now you just have to upload your file on tepee website in order for it to be tested by the tepee team.</p>
<a name="plugins-exemple"></a>
<h2>Plugins exemple</h2>
<p>You can download the source of a test plugin at <a href="https://gitorious.org/tepee3d/tepee3d/trees/master/TestPlugin">https://gitorious.org/tepee3d/tepee3d/trees/master/TestPlugin</a></p>
</div>
<!-- @@@how_to_plugins.html -->
  </div>
 </div> 
</div> 
<footer class="footer">
 <div class="container">
  <div class="row">
   <div class="row">
    <div class="span2 offset1">
     <ul> 
      <li class="title">Tepee3D</li> 
      <li><a>Downloads</a></li> 
      <li><a>Developers</a></li> 
      <li><a>Contribute</a></li> 
      <li><a>Gitorious</a></li> 
     </ul> 
    </div> 
    <div class="span2">
     <ul> 
      <li class="title">Qt</li> 
      <li><a>Qt-Project</a></li> 
     </ul> 
    </div> 
    <div class="span2">
     <ul> 
      <li class="title">Contact</li> 
      <li><a><i class="icon-facebook"></i>&nbsp Facebook</a></li> 
      <li><a><i class="icon-twitter"></i>&nbsp Twitter</a></li> 
      <li><a><i class="icon-google-plus"></i>&nbsp Google+</a></li> 
      <li><a><i class="icon-envelope"></i>&nbsp @Mail</a></li> 
     </ul> 
    </div> 
   </div> 
  </div> 
 </div> 
</footer> 
</body>
</html>
